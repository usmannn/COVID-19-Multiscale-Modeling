<!DOCTYPE html>
<html>
<head>

	<script>
		// global list to store selection IDs
		var selected_ids = [];
		var selected_edge_ids = [];
		var popupTemplate;
		var view;
		var webmap;
		var layer;
		var timeSlider;
		var edges = [];
		var edgesString = "";
	</script>

	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>COVID-19 Multiscale Modeling</title>

	<!-- load 3rd-party CSV parsing libary  -->
	<script src="https://unpkg.com/papaparse@5.1/papaparse.min.js"></script>

	<link rel="stylesheet" href="https://js.arcgis.com/4.14/esri/themes/light/main.css">
	<script defer src="https://js.arcgis.com/4.14/"></script>
	
	<script>
		<!-- set Dojo configuration options -->
		var dojoConfig = {
			async: true,
			packages: [{
				name: 'Canvas-Flowmap-Layer',
				location: location.pathname.replace(/[^\/]+$/, '') + 'JS/External/Canvas-Flowmap-Layer'
			}]
		};
	</script>

	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="JS/External/Canvas-Flowmap-Layer/jquery.csv.js"></script>
	<script defer src="JS/site.js"></script>
	<script src="JS/reconstruct.js"></script>
	<link rel="stylesheet" href="CSS/site.css">

</head>
<body onload="load()">	

<div id="s_overlay">
			<div id="s_world" onclick="overlayOff(this.id)">World</div>
			<div id="s_us" onclick="overlayOff(this.id)">United States</div>
			<div id="s_ca" onclick="overlayOff(this.id)">Canada</div>
		</div>		
	<div id="viewDiv">
		
	</div>

	<div id="externalDiv">		
		<p id="counter_setup">
			<label id="counter_label" class="esri-widget esri-component">Days to Predict:</label>
			<input type="number" id="counter" name="days" step="7" size="1" class="esri-widget esri-component">
		</p>
		<p>
			<button type="button" onmouseover="showCounter()" class="btn btn-primary" id="construct_button" onclick="return processReconstruct();"> Re-Construct </button>
		</p>
	</div>
	
	<div id="sidebar" class="esri-widget">
		<div id="nodes">
			<table id="table_restricted_countries" class="table table-dark" style="color:white;" align="center">
				<thead>
					<tr>
						<td scope="col" colspan="3" style="text-align:center; font-weight: bold;">Restricted Countries</td>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div id="view_buffer"></div>
		<div id="edges">
			<table id="table_restricted_connections" class="table table-dark" style="color:white;" align="center">
				<thead>
					<tr>
						<td scope="col" colspan="3" style="text-align:center; font-weight: bold;">Restricted Connections</td>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>	
	
	<div id="timeSlider"></div>

	<div id="titleDiv" class="esri-widget">
		<div id="titleText">COVID-19 Multiscale Modeling</div>
	</div>
	<div id="edgesDiv"></div>	
</body>
</html>

<script>
	
	// callback to remove an entry from restricted countries list
	function clearCountrySelection(entry)
	{
		var i = entry.parentNode.parentNode.rowIndex;	
		var tmp = document.getElementById("table_restricted_countries").rows[i].cells[0].innerHTML;	
		selected_ids.splice(i-1, 1);
		document.getElementById("table_restricted_countries").deleteRow(i);	
	}
	
	function clearEdgeSelection(entry)
	{
		var i = entry.parentNode.parentNode.rowIndex;	
		var tmp = document.getElementById("table_restricted_connections").rows[i].cells[0].innerHTML;
		selected_edge_ids.splice(i-1, 1);
		document.getElementById("table_restricted_connections").deleteRow(i);
	}
	
	function processReconstruct()
	{
		var restricted_countries = [];
		var entries = document.getElementById("table_restricted_countries").rows;
		
		for(k=1; k < entries.length; k++)
		{	
			var name = entries[k].cells[1].innerHTML;
			restricted_countries.push(name);
		}
		
		var restricted_connections = [];
		var entries_c = document.getElementById("table_restricted_connections").rows;
		
		for(k=1; k < entries_c.length; k++)
		{	
			var name = entries_c[k].cells[0].innerHTML;
			restricted_connections.push(name);
		}
		
		var days_to_predict = document.getElementById("counter").value;
		
		reconstruct([restricted_countries, restricted_connections, days_to_predict]);
	}

	function overlayOff(selection_id) {
		document.getElementById("s_overlay").style.display = "none";
		document.getElementById("construct_button").style.display = "block";
		document.getElementById("timeSlider").style.display = "block";
		document.getElementById("edgesDiv").style.display = "block";
		initialize(selection_id);
	}
	
	function showCounter(){
		document.getElementById("counter_setup").style.display  = "block";
	}

</script>
